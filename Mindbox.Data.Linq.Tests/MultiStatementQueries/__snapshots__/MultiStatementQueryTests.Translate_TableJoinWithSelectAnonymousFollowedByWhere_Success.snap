****************************** Original expression **********************************
Table(Customer).Select(c => new <>f__AnonymousType1`2(CA = value(Mindbox.Data.Linq.Tests.MultiStatementQueries.MultiStatementQueryTests+<>c__DisplayClass16_0).customerActions.Where(ca => (ca.Customer == c)).FirstOrDefault(), CustomerArea = c.Area)).Where(c => ((c.CA.ActionTemplate.Name == "dummy") AndAlso (c.CA.StaffId == Convert(10, Nullable`1)))).Where(c => (c.CustomerArea.Id == 20))

****************************** SQL result *******************************************
DECLARE @tabledirectcrm_Customers TABLE(
    AreaId int not null,
    Id int not null
)
DECLARE @tabledirectcrm_CustomerActions TABLE(
    ActionTemplateId int not null,
    CustomerId int not null,
    StaffId int null
)
DECLARE @tabledirectcrm_ActionTemplates TABLE(
    Id int not null,
    Name nvarchar(32) not null
)
DECLARE @tabledirectcrm_Areas TABLE(
    Id int not null
)

INSERT INTO @tabledirectcrm_Customers(AreaId, Id)
    SELECT current.AreaId, current.Id
        FROM directcrm.Customers AS current
            WHERE Id = @__id
SELECT * FROM @tabledirectcrm_Customers

INSERT INTO @tabledirectcrm_CustomerActions(ActionTemplateId, CustomerId, StaffId)
    SELECT current.ActionTemplateId, current.CustomerId, current.StaffId
        FROM directcrm.CustomerActions AS current
            INNER JOIN @tabledirectcrm_Customers AS previous ON
                previous.Id = current.CustomerId
SELECT * FROM @tabledirectcrm_CustomerActions

INSERT INTO @tabledirectcrm_ActionTemplates(Id, Name)
    SELECT current.Id, current.Name
        FROM directcrm.ActionTemplates AS current
            INNER JOIN (SELECT DISTINCT ActionTemplateId FROM @tabledirectcrm_CustomerActions) AS previous ON
                previous.ActionTemplateId = current.Id
SELECT * FROM @tabledirectcrm_ActionTemplates

INSERT INTO @tabledirectcrm_Areas(Id)
    SELECT current.Id
        FROM directcrm.Areas AS current
            INNER JOIN (SELECT DISTINCT AreaId FROM @tabledirectcrm_Customers) AS previous ON
                previous.AreaId = current.Id
SELECT * FROM @tabledirectcrm_Areas

****************************** Rewritten expression **********************************
resultSet => resultSet.GetTable("directcrm.Customers").Select(c => new MyAnon_0(CA = resultSet.GetTable("directcrm.CustomerActions").Where(ca => (ca.GetReferencedRow("directcrm.Customers", "CustomerId", "Id") == c)).FirstOrDefault(), CustomerArea = c.GetReferencedRow("directcrm.Areas", "AreaId", "Id"))).Where(c => ((c.CA.GetReferencedRow("directcrm.ActionTemplates", "ActionTemplateId", "Id").GetValue("Name") == "dummy") AndAlso (c.CA.GetValue("StaffId") == Convert(10, Nullable`1)))).Where(c => (c.CustomerArea.GetValue("Id") == 20)).Any()
